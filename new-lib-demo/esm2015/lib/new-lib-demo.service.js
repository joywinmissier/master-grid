import { __awaiter } from "tslib";
import { DatePipe } from '@angular/common';
import { Injectable } from '@angular/core';
import { Workbook } from 'exceljs';
import * as fs from 'file-saver';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
export class NewLibDemoService {
    constructor(datePipe) {
        this.datePipe = datePipe;
        this.dataForXSLX = [];
        this.dummExcelDT = [];
    }
    // method to seperate subitems and make flat json
    getSeperation(dumData, startIndex = 0, forExcel = false, selectedExport = false) {
        startIndex == 0 ? this.dummExcelDT = [] : '';
        dumData.map((data) => {
            if (data['checked'] && forExcel && selectedExport) {
                this.dummExcelDT.push(data);
            }
            else {
                this.dummExcelDT.push(data);
            }
            if (data.hasOwnProperty("subitems")) {
                data['subitems'].length > 0 ? this.getSeperation(data['subitems'], 1, forExcel) : '';
            }
        });
        this.dataForXSLX = [];
        this.dataForXSLX = JSON.parse(JSON.stringify(this.dummExcelDT));
        forExcel ? this.removeGargabeKeyValue(this.dataForXSLX) : '';
        return this.dataForXSLX;
    }
    // remove unwanted json keys to avoid shown in excel 
    removeGargabeKeyValue(flattenFilter) {
        flattenFilter.map((dataToFilter) => {
            delete dataToFilter['subitems'];
            delete dataToFilter['expansion'];
            delete dataToFilter['checked'];
            delete dataToFilter['id'];
            delete dataToFilter['parentName'];
            delete dataToFilter['parentId'];
            delete dataToFilter['hasChild'];
        });
    }
    // method to generate excel and save as file .xlsx
    generateExcel(dataForExcel, titleForExcel, sheetNameForExcel, dataForValues) {
        return __awaiter(this, void 0, void 0, function* () {
            // Excel Title, Header, Data
            const title = titleForExcel;
            const header = Object.keys(dataForValues[0]).slice(0, -2);
            // Create workbook and worksheet
            const workbook = new Workbook();
            const worksheet = workbook.addWorksheet(sheetNameForExcel);
            // Add Row and formatting
            const titleRow = worksheet.addRow([title]);
            titleRow.font = { name: 'Comic Sans MS', family: 4, size: 16, underline: 'double', bold: true };
            worksheet.addRow([]);
            const subTitleRow = worksheet.addRow(['Date : ' + this.datePipe.transform(new Date(), 'medium')]);
            worksheet.mergeCells('A1:D2');
            // Blank Row
            worksheet.addRow([]);
            // Add Header Row
            const headerRow = worksheet.addRow(header);
            // Cell Style : Fill and Border
            headerRow.eachCell((cell, number) => {
                cell.font = {
                    color: { argb: "ffffff" }
                };
                cell.fill = {
                    type: 'pattern',
                    pattern: 'solid',
                    fgColor: { argb: '460073' },
                };
                cell.border = { top: { style: 'thin' }, left: { style: 'thin' }, bottom: { style: 'thin' }, right: { style: 'thin' } };
            });
            // Add Data and Conditional Formatting
            dataForExcel.forEach((d, index) => {
                if (dataForValues[index]['isParent']) {
                    worksheet.addRow([]);
                    let sub = d.slice(0, -2);
                    const row = worksheet.addRow(sub);
                    row.getCell(1).font = {
                        bold: true
                    };
                }
                else {
                    let sub1 = d.slice(0, -2);
                    const row = worksheet.addRow(sub1);
                    row.getCell(1).alignment = { indent: this.dummExcelDT[index]['index'] };
                }
            });
            worksheet.getColumn(1).width = 60;
            worksheet.getColumn(3).width = 30;
            worksheet.getColumn(4).width = 30;
            worksheet.addRow([]);
            // Footer Row
            const footerRow = worksheet.addRow(['Report Generated Using Master-Grid Angular Library']);
            footerRow.getCell(1).fill = {
                type: 'pattern',
                pattern: 'solid',
                fgColor: { argb: 'FFCCFFE5' }
            };
            footerRow.getCell(1).border = { top: { style: 'thin' }, left: { style: 'thin' }, bottom: { style: 'thin' }, right: { style: 'thin' } };
            // Merge Cells
            worksheet.mergeCells(`A${footerRow.number}:F${footerRow.number}`);
            // Generate Excel File with given name
            workbook.xlsx.writeBuffer().then((data) => {
                const blob = new Blob([data], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
                fs.saveAs(blob, 'Profit Loss.xlsx');
            });
        });
    }
}
NewLibDemoService.ɵprov = i0.ɵɵdefineInjectable({ factory: function NewLibDemoService_Factory() { return new NewLibDemoService(i0.ɵɵinject(i1.DatePipe)); }, token: NewLibDemoService, providedIn: "root" });
NewLibDemoService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
NewLibDemoService.ctorParameters = () => [
    { type: DatePipe }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmV3LWxpYi1kZW1vLnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9wcm9qZWN0cy9uZXctbGliLWRlbW8vc3JjL2xpYi9uZXctbGliLWRlbW8uc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzNDLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFM0MsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLFNBQVMsQ0FBQztBQUNuQyxPQUFPLEtBQUssRUFBRSxNQUFNLFlBQVksQ0FBQzs7O0FBS2pDLE1BQU0sT0FBTyxpQkFBaUI7SUFNNUIsWUFBb0IsUUFBa0I7UUFBbEIsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUp0QyxnQkFBVyxHQUFHLEVBQUUsQ0FBQztRQUVqQixnQkFBVyxHQUFHLEVBQUUsQ0FBQztJQUV5QixDQUFDO0lBRTNDLGlEQUFpRDtJQUNqRCxhQUFhLENBQUMsT0FBTyxFQUFFLFVBQVUsR0FBRyxDQUFDLEVBQUUsUUFBUSxHQUFHLEtBQUssRUFBRSxjQUFjLEdBQUcsS0FBSztRQUM3RSxVQUFVLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO1FBQzdDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLEVBQUMsRUFBRTtZQUdsQixJQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxRQUFRLElBQUksY0FBYyxFQUFDO2dCQUMvQyxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQzthQUM3QjtpQkFDSTtnQkFDSCxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQzthQUM3QjtZQUNELElBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxVQUFVLENB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QUFDLENBQUM7WUFFbEUsc0NBQXNDO1lBQ3RDLFFBQVEsQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBUyxFQUFFLEVBQUU7Z0JBQzdDLE1BQU0sSUFBSSxHQUFHLElBQUksSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRSxJQUFJLEVBQUUsbUVBQW1FLEVBQUUsQ0FBQyxDQUFDO2dCQUM3RyxFQUFFLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxrQkFBa0IsQ0FBQyxDQUFDO1lBQ3RDLENBQUMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztLQUFBOzs7O1lBaElGLFVBQVUsU0FBQztnQkFDVixVQUFVLEVBQUUsTUFBTTthQUNuQjs7O1lBUlEsUUFBUSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERhdGVQaXBlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcclxuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5cclxuaW1wb3J0IHsgV29ya2Jvb2sgfSBmcm9tICdleGNlbGpzJztcclxuaW1wb3J0ICogYXMgZnMgZnJvbSAnZmlsZS1zYXZlcic7XHJcblxyXG5ASW5qZWN0YWJsZSh7XHJcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBOZXdMaWJEZW1vU2VydmljZSB7XHJcblxyXG4gIGRhdGFGb3JYU0xYID0gW107XHJcblxyXG4gIGR1bW1FeGNlbERUID0gW107XHJcblxyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgZGF0ZVBpcGU6IERhdGVQaXBlKSB7IH1cclxuXHJcbiAgLy8gbWV0aG9kIHRvIHNlcGVyYXRlIHN1Yml0ZW1zIGFuZCBtYWtlIGZsYXQganNvblxyXG4gIGdldFNlcGVyYXRpb24oZHVtRGF0YSwgc3RhcnRJbmRleCA9IDAsIGZvckV4Y2VsID0gZmFsc2UsIHNlbGVjdGVkRXhwb3J0ID0gZmFsc2Upe1xyXG4gICAgc3RhcnRJbmRleCA9PSAwID8gdGhpcy5kdW1tRXhjZWxEVCA9IFtdIDogJyc7XHJcbiAgICBkdW1EYXRhLm1hcCgoZGF0YSk9PntcclxuICAgICBcclxuICAgICAgXHJcbiAgICAgIGlmKGRhdGFbJ2NoZWNrZWQnXSAmJiBmb3JFeGNlbCAmJiBzZWxlY3RlZEV4cG9ydCl7XHJcbiAgICAgICAgdGhpcy5kdW1tRXhjZWxEVC5wdXNoKGRhdGEpO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIHRoaXMuZHVtbUV4Y2VsRFQucHVzaChkYXRhKTtcclxuICAgICAgfVxyXG4gICAgICBpZihkYXRhLmhhc093blByb3BlcnR5KFwic3ViaXRlbXNcIikpe1xyXG4gICAgICAgIGRhdGFbJ3N1Yml0ZW1zJ10ubGVuZ3RoID4gMCA/IHRoaXMuZ2V0U2VwZXJhdGlvbihkYXRhWydzdWJpdGVtcyddLCAxLCBmb3JFeGNlbCkgOiAnJztcclxuICAgICAgfVxyXG4gICAgfSlcclxuICAgIHRoaXMuZGF0YUZvclhTTFggPSBbXTtcclxuICAgIHRoaXMuZGF0YUZvclhTTFggPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuZHVtbUV4Y2VsRFQpKTtcclxuICAgIGZvckV4Y2VsID8gdGhpcy5yZW1vdmVHYXJnYWJlS2V5VmFsdWUodGhpcy5kYXRhRm9yWFNMWCkgOiAnJztcclxuICAgIHJldHVybiB0aGlzLmRhdGFGb3JYU0xYO1xyXG4gIH1cclxuXHJcbiAgLy8gcmVtb3ZlIHVud2FudGVkIGpzb24ga2V5cyB0byBhdm9pZCBzaG93biBpbiBleGNlbCBcclxuICByZW1vdmVHYXJnYWJlS2V5VmFsdWUoZmxhdHRlbkZpbHRlcil7XHJcbiAgICBmbGF0dGVuRmlsdGVyLm1hcCgoZGF0YVRvRmlsdGVyKT0+e1xyXG4gICAgICBkZWxldGUgZGF0YVRvRmlsdGVyWydzdWJpdGVtcyddO1xyXG4gICAgICBkZWxldGUgZGF0YVRvRmlsdGVyWydleHBhbnNpb24nXTtcclxuICAgICAgZGVsZXRlIGRhdGFUb0ZpbHRlclsnY2hlY2tlZCddO1xyXG4gICAgICBkZWxldGUgZGF0YVRvRmlsdGVyWydpZCddO1xyXG4gICAgICBkZWxldGUgZGF0YVRvRmlsdGVyWydwYXJlbnROYW1lJ107XHJcbiAgICAgIGRlbGV0ZSBkYXRhVG9GaWx0ZXJbJ3BhcmVudElkJ107XHJcbiAgICAgIGRlbGV0ZSBkYXRhVG9GaWx0ZXJbJ2hhc0NoaWxkJ107XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8vIG1ldGhvZCB0byBnZW5lcmF0ZSBleGNlbCBhbmQgc2F2ZSBhcyBmaWxlIC54bHN4XHJcbiAgYXN5bmMgZ2VuZXJhdGVFeGNlbChkYXRhRm9yRXhjZWwsIHRpdGxlRm9yRXhjZWwsIHNoZWV0TmFtZUZvckV4Y2VsLCBkYXRhRm9yVmFsdWVzKSB7XHJcblxyXG4gICAgICAvLyBFeGNlbCBUaXRsZSwgSGVhZGVyLCBEYXRhXHJcbiAgICAgIGNvbnN0IHRpdGxlID0gdGl0bGVGb3JFeGNlbDtcclxuICAgICAgY29uc3QgaGVhZGVyID0gT2JqZWN0LmtleXMoZGF0YUZvclZhbHVlc1swXSkuc2xpY2UoMCwtMik7XHJcblxyXG4gICAgICAvLyBDcmVhdGUgd29ya2Jvb2sgYW5kIHdvcmtzaGVldFxyXG4gICAgICBjb25zdCB3b3JrYm9vayA9IG5ldyBXb3JrYm9vaygpO1xyXG4gICAgICBjb25zdCB3b3Jrc2hlZXQgPSB3b3JrYm9vay5hZGRXb3Jrc2hlZXQoc2hlZXROYW1lRm9yRXhjZWwpO1xyXG5cclxuICAgICAgLy8gQWRkIFJvdyBhbmQgZm9ybWF0dGluZ1xyXG4gICAgICBjb25zdCB0aXRsZVJvdyA9IHdvcmtzaGVldC5hZGRSb3coW3RpdGxlXSk7XHJcbiAgICAgIHRpdGxlUm93LmZvbnQgPSB7IG5hbWU6ICdDb21pYyBTYW5zIE1TJywgZmFtaWx5OiA0LCBzaXplOiAxNiwgdW5kZXJsaW5lOiAnZG91YmxlJywgYm9sZDogdHJ1ZSB9O1xyXG4gICAgICB3b3Jrc2hlZXQuYWRkUm93KFtdKTtcclxuICAgICAgY29uc3Qgc3ViVGl0bGVSb3cgPSB3b3Jrc2hlZXQuYWRkUm93KFsnRGF0ZSA6ICcgKyB0aGlzLmRhdGVQaXBlLnRyYW5zZm9ybShuZXcgRGF0ZSgpLCAnbWVkaXVtJyldKTtcclxuXHJcbiAgICAgIHdvcmtzaGVldC5tZXJnZUNlbGxzKCdBMTpEMicpO1xyXG5cclxuICAgICAgLy8gQmxhbmsgUm93XHJcbiAgICAgIHdvcmtzaGVldC5hZGRSb3coW10pO1xyXG5cclxuICAgICAgLy8gQWRkIEhlYWRlciBSb3dcclxuICAgICAgY29uc3QgaGVhZGVyUm93ID0gd29ya3NoZWV0LmFkZFJvdyhoZWFkZXIpO1xyXG4gICAgXHJcbiAgICAgIC8vIENlbGwgU3R5bGUgOiBGaWxsIGFuZCBCb3JkZXJcclxuICAgICAgaGVhZGVyUm93LmVhY2hDZWxsKChjZWxsLCBudW1iZXIpID0+IHtcclxuICAgICAgICBjZWxsLmZvbnQgPSB7XHJcbiAgICAgICAgICBjb2xvcjoge2FyZ2I6IFwiZmZmZmZmXCJ9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNlbGwuZmlsbCA9IHtcclxuICAgICAgICAgIHR5cGU6ICdwYXR0ZXJuJyxcclxuICAgICAgICAgIHBhdHRlcm46ICdzb2xpZCcsXHJcbiAgICAgICAgICBmZ0NvbG9yOiB7IGFyZ2I6ICc0NjAwNzMnIH0sXHJcbiAgICAgICAgICAvLyBiZ0NvbG9yOiB7IGFyZ2I6ICc0NjAwNzMnIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIGNlbGwuYm9yZGVyID0geyB0b3A6IHsgc3R5bGU6ICd0aGluJyB9LCBsZWZ0OiB7IHN0eWxlOiAndGhpbicgfSwgYm90dG9tOiB7IHN0eWxlOiAndGhpbicgfSwgcmlnaHQ6IHsgc3R5bGU6ICd0aGluJyB9IH07XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBBZGQgRGF0YSBhbmQgQ29uZGl0aW9uYWwgRm9ybWF0dGluZ1xyXG4gICAgZGF0YUZvckV4Y2VsLmZvckVhY2goKGQsaW5kZXgpID0+IHtcclxuXHJcbiAgICAgIGlmKGRhdGFGb3JWYWx1ZXNbaW5kZXhdWydpc1BhcmVudCddKXtcclxuICAgICAgICB3b3Jrc2hlZXQuYWRkUm93KFtdKTtcclxuICAgICAgICBsZXQgc3ViID0gZC5zbGljZSgwLCAtMik7XHJcbiAgICAgICAgY29uc3Qgcm93ID0gd29ya3NoZWV0LmFkZFJvdyhzdWIpO1xyXG4gICAgICAgIHJvdy5nZXRDZWxsKDEpLmZvbnQgPSB7XHJcbiAgICAgICAgICBib2xkOiB0cnVlXHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIGVsc2V7XHJcbiAgICAgICAgbGV0IHN1YjEgPSBkLnNsaWNlKDAsIC0yKTtcclxuICAgICAgICBjb25zdCByb3cgPSB3b3Jrc2hlZXQuYWRkUm93KHN1YjEpO1xyXG4gICAgICAgIHJvdy5nZXRDZWxsKDEpLmFsaWdubWVudCA9IHsgaW5kZW50OiB0aGlzLmR1bW1FeGNlbERUW2luZGV4XVsnaW5kZXgnXSB9O1xyXG5cclxuICAgICAgfVxyXG5cclxuICAgIH0pO1xyXG5cclxuICAgIHdvcmtzaGVldC5nZXRDb2x1bW4oMSkud2lkdGggPSA2MDtcclxuICAgIHdvcmtzaGVldC5nZXRDb2x1bW4oMykud2lkdGggPSAzMDtcclxuICAgIHdvcmtzaGVldC5nZXRDb2x1bW4oNCkud2lkdGggPSAzMDtcclxuICAgIHdvcmtzaGVldC5hZGRSb3coW10pO1xyXG5cclxuXHJcbiAgICAvLyBGb290ZXIgUm93XHJcbiAgICBjb25zdCBmb290ZXJSb3cgPSB3b3Jrc2hlZXQuYWRkUm93KFsnUmVwb3J0IEdlbmVyYXRlZCBVc2luZyBNYXN0ZXItR3JpZCBBbmd1bGFyIExpYnJhcnknXSk7XHJcbiAgICBmb290ZXJSb3cuZ2V0Q2VsbCgxKS5maWxsID0ge1xyXG4gICAgICB0eXBlOiAncGF0dGVybicsXHJcbiAgICAgIHBhdHRlcm46ICdzb2xpZCcsXHJcbiAgICAgIGZnQ29sb3I6IHsgYXJnYjogJ0ZGQ0NGRkU1JyB9XHJcbiAgICB9O1xyXG4gICAgZm9vdGVyUm93LmdldENlbGwoMSkuYm9yZGVyID0geyB0b3A6IHsgc3R5bGU6ICd0aGluJyB9LCBsZWZ0OiB7IHN0eWxlOiAndGhpbicgfSwgYm90dG9tOiB7IHN0eWxlOiAndGhpbicgfSwgcmlnaHQ6IHsgc3R5bGU6ICd0aGluJyB9IH07XHJcblxyXG4gICAgLy8gTWVyZ2UgQ2VsbHNcclxuICAgIHdvcmtzaGVldC5tZXJnZUNlbGxzKGBBJHtmb290ZXJSb3cubnVtYmVyfTpGJHtmb290ZXJSb3cubnVtYmVyfWApO1xyXG5cclxuICAgIC8vIEdlbmVyYXRlIEV4Y2VsIEZpbGUgd2l0aCBnaXZlbiBuYW1lXHJcbiAgICB3b3JrYm9vay54bHN4LndyaXRlQnVmZmVyKCkudGhlbigoZGF0YTogYW55KSA9PiB7XHJcbiAgICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbZGF0YV0sIHsgdHlwZTogJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC5zcHJlYWRzaGVldG1sLnNoZWV0JyB9KTtcclxuICAgICAgZnMuc2F2ZUFzKGJsb2IsICdQcm9maXQgTG9zcy54bHN4Jyk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG59XHJcbiJdfQ==